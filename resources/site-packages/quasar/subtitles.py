from quasar.addon import ADDON
from quasar.logger import log
from quasar.srt2ass import srt2ass


def getColorFromSetting(setting):
    colors = ["black", "white", "yellow", "blue", "no_color"]
    return colors[int(ADDON.getSetting(setting))]


def getBorderStyleFromSetting(setting):
    borderStyle = ["border", "rectangle"]
    return borderStyle[int(ADDON.getSetting(setting))]


def convertSubtitle(subtitle):
    if ADDON.getSetting("use_ass_subtitles") == "false":
        log.debug("Using simple subtitles")
        return subtitle

    fontSize = ADDON.getSetting("font_size")
    subtitleColor = getColorFromSetting("subtitle_color")
    secondaryColor = getColorFromSetting("secondary_color")
    outlineColor = getColorFromSetting("outline_color")
    borderStyle = getBorderStyleFromSetting("border_style")
    marginL = ADDON.getSetting("margin_l")
    marginR = ADDON.getSetting("margin_r")
    marginV = ADDON.getSetting("margin_v")

    outFile = srt2ass(subtitle, font_name="Arial", font_size=fontSize, subtitle_color=subtitleColor,
                      secondary_color=secondaryColor, outline_color=outlineColor, shadow_color="black",
                      border_style=borderStyle, outline_px="1", shadow_px="0", margin_l=marginL,
                      margin_r=marginR, margin_v=marginV)

    if outFile is not None:
        log.debug("Unable to convert subtitles")
        return outFile

    log.debug("Subitles successfully converted using Advanced Sub Station Alpha v4+")
    return subtitle
